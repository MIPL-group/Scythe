//http://stackoverflow.com/questions/37575793/get-first-row-per-product-after-a-certain-date

#input

|product_code | qty | stock_before | stock_after |   date     |
|-------------------------------------------------------------|
| xpto1       |  0  |            1 |           1 | 2015-01-01 |
| xpto1       |  1  |            1 |           2 | 2015-02-01 |
| xpto1       |  2  |           -1 |           1 | 2015-03-01 |
| xpto2       |  0  |            1 |           1 | 2015-01-01 |
| xpto2       |  1  |            1 |           2 | 2015-02-01 |
| xpto2       |  2  |           -1 |           1 | 2015-03-01 |

#output

|product_code | qty | stock_before | stock_after |   date     |
|--------------------------------|
| xpto1 | 1 | 1 | 2 | 2015-02-01 |
| xpto2 | 1 | 1 | 2 | 2015-02-01 |

#constraint
{
	"constants": ["2015-01-01"],
	"aggregation_functions": ["max"]
}

#solution

select t.*
(select product_code, max(qty) mqty
 from t
 where t.date > 2015-01-01
 group by product_code) x join t
on t.product_code = x.product_code
   t.qty = x.mqty
